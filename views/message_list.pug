doctype html
html
  head
    meta(charset='UTF-8')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    title= title || 'Customer Messages'

    //-Using the correct Bootstrap 5.3.3 integrity
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous")
    link(href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet")
    link(rel="stylesheet", href="/css/tables.css")

  body(style="background-color: #f6f9faff;") 
    nav.navbar.navbar-expand-lg.navbar-custom
      .container-fluid
        a.navbar-brand(href='/') MAYONDO INVENTORY MANAGEMENT SYSTEM
        button.navbar-toggler(type='button', data-bs-toggle='collapse', data-bs-target='#navbarNav', aria-controls='navbarNav', aria-expanded='false', aria-label='Toggle navigation')
          span.navbar-toggler-icon
        .collapse.navbar-collapse#navbarNav
          ul.navbar-nav.ms-auto
            li.nav-item
              a.nav-link(href='/') Home  |
            li.nav-item
              a.nav-link(href='/woodRegistered') View Wood Stock  |
            li.nav-item
              a.nav-link(href='/furnitureRegistered') View Furniture Stock  |
            li.nav-item
              a.nav-link(href='/recordfurnitureSale') Add Furniture Sale |
            li.nav-item
              a.nav-link(href='/recordwoodSale') Add Wood Sale  |
            li.nav-item
              a.nav-link(href='/logout')
                button.login-btn Logout

    .container.py-5
      .row
        .col-12
          
          .d-flex.justify-content-between.align-items-center.mb-4
            h1.text-dark.fw-bold
              | Customer Contact Messages
            
            a.btn.btn-outline-danger(href='/viewboard') 
              span.material-icons-outlined.me-1 dashboard
              | Dashboard

          p.lead.text-muted Reviews communication received from customers via the contact form.
          
          hr.mb-5

          //- Messages List Table 
          if messages && messages.length > 0
            h3.mb-4 Total Messages: 
              span.badge.bg-secondary #{messages.length}

              //-Ensures table scrolls horizontally on small screens
            .table-responsive 
              table.table.table-striped.table-hover.table-bordered.align-middle
                thead.table-dark
                  tr
                    th Status
                    th Customer Name
                    th Email
                    th Message Preview
                    th Received At
                    th Actions

                tbody
                  each message in messages
                    tr(class=message.isRead ? 'table-light' : 'table-warning fw-bold') 
                      td
                        span.badge(class=message.isRead ? 'bg-secondary' : 'bg-danger')
                          if message.isRead
                            | Read
                          else
                            | New
                            
                      td= message.fullName
                      td= message.email
                      td 
                        //- Show a truncated preview of the message
                        | #{message.message.substring(0, 50)}... 
                      
                      td 
                        | #{new Date(message.receivedAt).toLocaleDateString()}
                        br
                        span.text-muted.small #{new Date(message.receivedAt).toLocaleTimeString()}
                      
                      td
                        if !message.isRead
                          a.btn.btn-sm.btn-success(href='/manager/messages/mark-read/' + message._id) Mark as Read
                        else
                          span.text-success.small Archived
                          
          else
          //-     //-  No Messages State
          //- .alert.alert-info.text-center.mt-5
          //-     h4.alert-heading No New Messages!
          //-     p The contact inbox is currently empty.
          //-     span.material-icons-outlined.text-info.display-4 check_circle


              

   
script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js')